# 使用指南

## 管理员配置流程

首次部署后，按以下顺序配置系统：

### 1. 修改管理员密码

1. 访问 http://服务器IP:5000/admin
2. 使用默认账号登录：`admin@qq.com` / `admin123`
3. 进入「个人中心」修改密码

### 2. 配置 Cloudflare 账户

#### 获取 API Token

1. 登录 [Cloudflare Dashboard](https://dash.cloudflare.com)
2. 点击右上角头像 → **My Profile**
3. 选择 **API Tokens** → **Create Token**
4. 使用 **Edit zone DNS** 模板，或自定义权限：
   - `Zone - DNS - Edit`
   - `Zone - Zone - Read`
5. 复制生成的 Token

#### 获取 Zone ID

1. 进入域名管理页面
2. 右侧 **API** 区域可看到 **Zone ID**

#### 添加 CF 账户

1. 进入管理后台 → **CF账户管理**
2. 点击「添加账户」
3. 填写账户名称和 API Token
4. 点击「验证」确认 Token 有效
5. 保存

### 3. 添加主域名

1. 进入管理后台 → **域名管理**
2. 点击「添加域名」
3. 选择 CF 账户
4. 输入域名（如 `example.com`）
5. 输入 Zone ID
6. 保存

### 4. 创建套餐

1. 进入管理后台 → **套餐管理**
2. 点击「添加套餐」
3. 配置套餐参数：

| 参数 | 说明 |
|------|------|
| 套餐名称 | 显示给用户的名称 |
| 关联域名 | 可选择多个域名 |
| 价格 | 0 为免费套餐 |
| 有效期 | -1 为永久 |
| 域名长度 | 限制前缀长度 |
| 最大记录数 | -1 为无限 |

### 5. 配置系统设置

进入管理后台 → **系统设置**：

#### 基础设置

| 设置项 | 说明 |
|--------|------|
| 站点名称 | 显示在页面标题 |
| 站点描述 | SEO 描述 |
| 站点 URL | 用于邮件链接 |
| 允许注册 | 开关用户注册 |

#### SMTP 邮件配置

| 设置项 | 说明 | 示例 |
|--------|------|------|
| SMTP 服务器 | 邮件服务器地址 | smtp.qq.com |
| SMTP 端口 | SSL 用 465，TLS 用 587 | 465 |
| SMTP 用户名 | 发件邮箱 | noreply@example.com |
| SMTP 密码 | 授权码或密码 | - |
| 启用 SSL | 是否使用 SSL | 是 |

> 配置后点击「测试发送」验证配置是否正确

### 6. 生成卡密

1. 进入管理后台 → **卡密管理**
2. 点击「批量生成」
3. 设置金额和数量
4. 生成后可导出分发给用户

---

## 用户使用流程

### 1. 注册账号

1. 访问系统首页
2. 点击「注册」
3. 填写邮箱（如配置了 SMTP，需要邮箱验证）
4. 设置用户名和密码
5. 完成注册

### 2. 充值余额

1. 登录后进入「个人中心」
2. 点击「充值」
3. 输入卡密码
4. 确认充值

### 3. 购买域名

1. 进入「域名购买」页面
2. 选择主域名
3. 输入想要的前缀（如 `mysite`）
4. 选择套餐
5. 可选：输入优惠码
6. 确认购买

### 4. 管理 DNS 记录

1. 进入「我的域名」
2. 点击域名进入详情
3. 添加 DNS 记录：

| 记录类型 | 用途 | 示例 |
|----------|------|------|
| A | 指向 IPv4 地址 | 1.2.3.4 |
| AAAA | 指向 IPv6 地址 | 2001:db8::1 |
| CNAME | 别名指向 | cdn.example.com |
| TXT | 文本记录 | v=spf1 ... |
| MX | 邮件服务器 | mail.example.com |

### 5. NS 托管切换

如需使用自己的 DNS 服务器：

1. 进入域名详情
2. 点击「NS 设置」
3. 输入 NS 服务器地址（如 `ns1.dnspod.net`）
4. 确认切换

> 切换 NS 后，原有 DNS 记录将被清除

### 6. 域名续费

1. 进入「我的域名」
2. 点击需要续费的域名
3. 点击「续费」
4. 选择续费套餐
5. 确认支付

---

## 安全设置

### 启用双因素认证 (2FA)

1. 进入「安全设置」
2. 点击「启用 2FA」
3. 使用 Authenticator App 扫描二维码
4. 输入验证码确认
5. **保存备用码**（重要！）

支持的 Authenticator App：
- Google Authenticator
- Microsoft Authenticator
- Authy
- 1Password

### IP 白名单

限制只能从特定 IP 登录：

1. 进入「安全设置」
2. 点击「IP 限制」
3. 添加允许的 IP 地址
4. 保存

---

## 管理后台功能

### 用户管理

| 功能 | 说明 |
|------|------|
| 查看用户 | 搜索、筛选用户列表 |
| 编辑用户 | 修改用户名、邮箱、角色 |
| 调整余额 | 增加或减少用户余额 |
| 重置密码 | 为用户设置新密码 |
| 禁用账户 | 暂停用户访问 |

### 域名管理

| 功能 | 说明 |
|------|------|
| 查看域名 | 查看所有用户的二级域名 |
| 延期 | 延长域名有效期 |
| 停用/启用 | 控制域名状态 |
| 批量操作 | 批量删除、延期 |

### 优惠券管理

创建优惠券：

| 类型 | 说明 | 示例 |
|------|------|------|
| 折扣券 | 按比例优惠 | 9折 = value: 9 |
| 满减券 | 固定金额减免 | 减5元 = value: 5 |

### 公告管理

| 选项 | 说明 |
|------|------|
| 置顶 | 显示在公告列表顶部 |
| 弹窗 | 用户登录后弹窗显示 |
| 状态 | 草稿/发布 |

### 数据统计

管理后台首页显示：
- 用户总数 / 今日新增
- 域名总数 / 今日新增
- 收入统计
- 到期域名提醒
- 趋势图表

---

## API 调用

系统提供完整的 REST API，详见：
- [用户端 API 文档](/api/user)
- [管理端 API 文档](/api/admin)

### 认证方式

```bash
# 登录获取 Token
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"123456"}'

# 使用 Token 访问 API
curl http://localhost:5000/api/auth/me \
  -H "Authorization: Bearer <your_token>"
```
