# 更新日志

本页面记录六趣DNS系统的版本更新历史，包括后端服务和APP客户端的更新内容。

---

## 后端更新日志

### 2026-01-03

#### Telegram 机器人域名购买按钮方式
- 域名购买改为全按钮方式，无需手动输入命令
- 购买流程：选择域名 → 选择套餐 → 点击"立即购买" → 输入前缀 → 自动完成购买
- 新增前缀格式和长度实时验证，输入错误可重新输入
- 购买成功后显示域名详情和快捷操作按钮

#### Telegram 机器人虚拟主机购买功能
- 新增虚拟主机商店入口，显示可购买的套餐列表
- 新增套餐详情页面，显示磁盘空间、流量、域名数等信息
- 新增 `/buyvhost <套餐ID> <域名>` 命令购买虚拟主机
- 新增按钮方式购买：点击"立即购买"后直接输入域名即可完成购买
- 购买成功后显示 FTP 和数据库凭据信息
- 完善主机详情显示（套餐、空间、流量、FTP/数据库凭据、服务器IP）

#### Telegram 机器人按钮布局优化
- 主菜单显示用户资源统计（域名数、主机数）
- 按钮布局重新设计：域名/主机放第一行，购买/充值放第二行，账户/余额放第三行
- 按钮文字显示实时数量（如"我的域名 (5)"）
- 新增"充值卡密"按钮和充值帮助页面
- 余额页面显示最近5条消费记录
- 帮助页面根据绑定状态显示不同内容和按钮
- 修复托管商申请未创建申请记录的问题
- 点击按钮后编辑原消息而非发送新消息，界面更整洁

#### Telegram 机器人功能
- 新增 Telegram 机器人管理功能
- 支持在管理后台配置 Bot Token
- 机器人随项目启动自动运行（轮询模式，无需公网）
- 自动记录 Telegram 用户信息到数据库
- 管理后台可查看绑定用户列表

---

### 2026-01-02

#### 版本更新检测系统重构
- 重构版本更新检测系统，支持新的远程 API 格式
- 更新弹窗显示当前版本、最新版本、发布时间
- 支持渲染 HTML 格式的更新日志
- 新增强制更新功能，强制更新时阻止管理后台操作
- 强制更新显示全屏遮罩层，必须更新后才能继续使用
- 非强制更新支持"稍后提醒"关闭弹窗
- 新增版本更新相关多语言翻译（中英文）

---

### 2026-01-01

#### 优惠券产品类型选择
- 优惠券新增"适用产品"选项，可选择：全部、域名、虚拟主机
- 管理后台优惠券列表显示适用产品类型标签
- 用户使用优惠码时自动验证产品类型是否匹配
- 数据库自动迁移添加 `applicable_type` 字段

#### 虚拟主机套餐服务器绑定
- 套餐管理新增服务器选择功能，可指定套餐创建在特定服务器上
- 不指定服务器时自动使用负载均衡分配
- 套餐列表显示关联的服务器名称
- 购买页面根据套餐服务器设置筛选显示

#### 管理后台批量删除功能
- 主机实例管理页面新增批量删除功能，支持多选删除
- 订单管理页面新增批量删除功能，支持多选删除
- 添加全选/取消全选功能
- 删除时显示进度提示
- 修复删除主机时只软删除不彻底删除的问题，现在会从数据库彻底删除记录
- 删除主机时同时清理关联的域名绑定记录

#### 虚拟主机运行目录、伪静态、SSL管理
- 新增运行目录设置功能，支持Laravel/ThinkPHP等框架设置/public目录
- 新增伪静态规则管理，支持WordPress、ThinkPHP、Laravel等常用模板
- 新增SSL证书部署功能，支持手动上传证书私钥和证书内容
- 新增Let's Encrypt免费证书一键申请功能
- 新增强制HTTPS开关，可一键开启/关闭HTTP到HTTPS跳转
- 新增SSL证书信息显示（颁发机构、到期时间）

#### 虚拟主机PHP版本管理
- 新增PHP版本切换功能，用户可在主机详情页切换PHP版本
- 创建主机时自动使用服务器默认PHP版本（而非纯静态）
- 支持获取服务器已安装的PHP版本列表
- 主机详情页显示当前PHP版本和可切换版本

#### 虚拟主机在线文件管理
- 新增在线文件管理功能，用户可在网页端管理网站文件
- 支持浏览目录、查看文件列表
- 支持新建文件/文件夹
- 支持在线编辑文本文件（html/css/js/php/txt等）
- 支持重命名、删除文件和目录
- 新增批量选择功能，支持全选/多选文件
- 新增批量复制/剪切/粘贴功能
- 新增批量删除功能
- 新增压缩功能，可将文件或目录压缩为zip包
- 新增解压功能，支持解压zip/tar/gz等压缩包
- 路径安全检查，确保只能访问用户自己的网站目录

#### 虚拟主机域名绑定功能
- 新增虚拟主机域名绑定管理功能
- 主机详情页显示已绑定域名列表
- 支持添加/删除域名绑定（受套餐域名数限制）
- 域名绑定自动同步到宝塔面板
- 新增 `vhost_domains` 数据表存储绑定域名

---

### 2025-12-31

#### 虚拟主机分发模块
- 新增虚拟主机分发功能，支持通过宝塔面板 API 自动化创建和管理虚拟主机
- 管理后台新增虚拟主机管理菜单：服务器管理、套餐管理、主机管理、订单管理
- 用户端新增虚拟主机功能：购买主机、我的主机、主机详情
- 支持服务器负载均衡，自动选择负载最低的服务器
- 支持主机续费、暂停、恢复、删除等操作
- 自动生成 FTP 和数据库凭据
- 主机详情页显示 FTP 和数据库连接信息
- 新增到期检查定时任务脚本 `scripts/check_vhost_expiry.py`
- 支持到期提醒邮件通知（提前7天、3天、1天）
- 过期主机自动暂停并更新状态

#### 阿里云邮件推送支持
- 新增阿里云 DirectMail 邮件推送支持
- 支持 SMTP 和阿里云 API 两种发送方式切换
- 管理后台系统设置新增阿里云邮件配置项
- 新增邮件发送测试接口，支持测试当前配置

#### 域名托管功能
- 新增域名托管系统，允许用户申请成为托管商
- 托管商可添加自己的DNS渠道、域名和套餐
- 其他用户购买托管商域名时，收益自动分配给托管商
- 平台可设置抽成比例，托管商获得扣除抽成后的收益
- 托管商面板：查看收益统计、管理渠道/域名/套餐、查看交易记录
- 管理员功能：审核托管申请、管理托管商、设置托管系统参数
- 支持暂停/恢复/撤销托管商权限

#### APP 客户端验证码支持
- APP 客户端请求时自动使用图形验证码，绕过 Cloudflare Turnstile
- APP 端需在请求头添加 `X-Client-Type: app` 标识
- 支持所有验证码场景：登录、注册、找回密码、修改密码、修改邮箱

#### 快捷登录功能完善
- 新增 GitHub、Google、NodeLoc 三种快捷登录方式
- 管理后台新增 OAuth 设置页面，可配置各平台的 Client ID 和 Secret
- OAuth 回调地址说明：回调 URL 基于当前站点域名自动生成
- 站点设置新增 `site_url` 配置项，支持自动获取当前域名
- 用户个人中心新增快捷登录绑定/解绑功能
- 管理后台用户列表显示 OAuth 绑定状态（GH/G/NL 图标），支持管理员解绑

#### 隐私政策与投诉举报
- 新增隐私政策页面 `/privacy`
- 新增投诉举报页面 `/abuse`
- 登录/注册页面新增隐私政策同意复选框，必须勾选才能提交
- 页脚新增隐私政策和投诉举报链接

---

### 2025-12-30

#### 深色模式主题切换
- 新增深色/浅色主题切换功能
- 侧边栏底部添加主题切换按钮，支持一键切换

#### 多语言支持（中英文）
- 新增中英文双语切换功能
- 侧边栏底部添加语言切换按钮

#### PowerDNS 支持
- 新增 PowerDNS 服务商支持，可对接自建 DNS 服务器
- 支持 PowerDNS Authoritative Server 的 HTTP API
- 配置项：API 地址、API Key、服务器ID
- 支持完整的 DNS 记录管理（A、AAAA、CNAME、MX、TXT、NS、SRV、CAA、PTR）
- 支持记录状态启用/禁用


#### 注册页面优化
- 关闭注册时显示管理员联系邮箱，方便用户申请注册

#### 网站统计代码
- 新增网站统计代码配置，支持百度统计、Google Analytics、51.la 等
- 管理员可在系统设置中粘贴统计代码，自动添加到所有页面

#### 邮箱后缀限制
- 新增注册邮箱后缀限制功能
- 支持白名单模式（只允许指定后缀）和黑名单模式（禁止指定后缀）
- 管理员可在系统设置中启用/禁用、选择模式、配置后缀列表
- 后缀列表支持每行一个，如 qq.com、gmail.com

#### 验证码场景开关
- 新增验证码场景开关功能，管理员可在系统设置中控制各场景是否需要验证码
- 支持5个场景独立控制：登录、注册、找回密码、修改密码、修改邮箱
- 前端页面根据配置自动显示/隐藏验证码
- 关闭验证码的场景可直接提交，无需验证

#### Cloudflare Turnstile 验证
- 新增 Cloudflare Turnstile 人机验证支持
- 管理员可在系统设置中配置 Turnstile Site Key 和 Secret Key
- 启用后自动替换图形验证码，提升用户体验
- 支持登录、注册、找回密码、修改密码、修改邮箱等场景
- 未配置时自动降级为图形验证码

#### 系统内存优化
- SQLAlchemy 连接池优化：显式设置 pool_size=5、max_overflow=10
- APScheduler 线程池从默认10减少到2，添加任务合并
- MemoryCache 限制最大条目500，优化清理策略
- 验证码图片尺寸优化：160x50 → 120x40
- Gunicorn worker 数量从4减少到2
- Docker 容器内存限制：App 512MB、Redis 64MB（LRU淘汰）

---

### 2025-12-29

#### 邮件模板自定义
- 新增邮件模板管理功能，支持在后台自定义邮件内容
- 支持7种邮件模板：注册验证、重置密码、邮箱变更、域名到期提醒、域名删除通知、自动续费成功/失败
- 模板支持变量替换，如站点名称、域名、到期时间等
- 支持启用/禁用模板、重置为默认模板
- 支持发送测试邮件到管理员邮箱
- 定时任务已更新为使用数据库模板发送邮件

#### 界面优化
- 首页移动端适配优化，修复内容超出屏幕问题
- 可用域名卡片移动端布局优化，支持长域名显示
- 管理后台首页添加版本号显示

---

### 2025-12-28

#### 六趣DNS分销模式
- 新增上游域名同步功能，支持从上游六趣DNS实例导入可用域名和套餐
- 管理员可在渠道管理中点击"同步域名"获取上游可购买的域名列表
- 支持选择性导入域名和套餐，自动设置默认售价（上游价格×1.2）
- 用户购买分销域名时自动调用上游API完成购买
- 用户续费分销域名时自动调用上游API完成续费

#### 开放API功能
- 新增用户开放API，支持外部系统对接
- 用户可在"账户设置 > API管理"生成/管理API密钥
- 支持API Key + Secret签名认证
- 支持IP白名单限制
- 提供完整的API接口：用户信息、域名列表、子域名管理、DNS记录管理

#### 六趣DNS渠道对接
- 新增"六趣DNS"服务商类型，支持对接其他六趣DNS实例
- 可作为下游系统对接上游六趣DNS的开放API
- 支持完整的DNS记录管理（增删改查）
- 配置项：API地址、API Key、API Secret

#### 移动端UI优化
- 修复登录/注册页面验证码输入框过长导致图片超出屏幕
- 修复用户首页卡片超出屏幕，改为2x2网格布局
- 修复用户个人中心修改邮箱/密码验证码输入框溢出
- 修复管理员DNS解析查询页面移动端布局问题
- 优惠券管理页面移动端改为卡片视图

#### 功能优化
- 优惠券支持排除域名功能，可指定某些域名不能使用优惠券
- 操作日志的操作类型和目标类型显示为中文

---

### 2025-12-27

#### 多DNS服务商支持

新增DNS服务商（共11种）：

| 服务商 | 说明 |
|--------|------|
| Cloudflare | 全球CDN，支持代理模式 |
| 阿里云DNS | 国内主流，支持线路解析 |
| 腾讯云DNSPod | 国内主流，支持线路和权重 |
| 华为云DNS | 国内云服务商 |
| 西部数码 | 国内域名服务商 |
| AWS Route53 | 亚马逊云DNS服务，支持权重路由 |
| GoDaddy | 国际域名注册商 |
| Namecheap | 国际域名注册商 |
| Name.com | 国际域名服务商 |
| 百度智能云 | 国内云服务商 |
| NameSilo | 国际域名注册商 |

功能特性：
- 统一的DNS服务接口，支持多种服务商
- 各服务商能力自动检测（线路、代理、权重）
- 渠道管理模块，灵活配置DNS凭证
- 支持A、AAAA、CNAME、TXT、MX、NS等记录类型

#### 界面优化
- 首页全新设计，现代化渐变风格
- 服务商图标展示，支持11种DNS服务商
- 统计数据展示（用户数、域名数、解析记录数）
- 四列特性卡片，悬停动效
- 域名卡片重新设计，申请流程优化
- 使用流程步骤展示，带连接线动画
- 底部改为白色主题，与整体风格协调
- 登录/注册按钮优化，未登录显示双按钮

---

### 2025-12-23

#### 新功能

| 功能 | 说明 |
|------|------|
| 购买页面域名实时检查 | 输入域名前缀时实时检测可用性 |
| 管理员仪表盘图表 | ECharts可视化展示用户、域名、订单统计 |
| IP黑名单管理 | 管理员可添加/删除IP黑名单 |
| 2FA安全设置 | 用户可启用TOTP双因素认证、生成备用码 |
| 优惠券管理 | 管理员创建/编辑优惠券，支持折扣和固定金额 |
| 购买支持优惠码 | 用户购买时可输入优惠码享受折扣 |
| 登录2FA验证 | 启用2FA的用户登录需输入6位验证码 |
| 删除域名2FA验证 | 启用2FA的用户删除域名需验证身份 |

#### 其他更新
- 手动模式：到期邮箱提示、删除DNS记录、删除域名
- 卡密管理：批量删除、禁用卡密
- 后台首页：更多统计卡片、快捷入口
- 2FA二维码使用QR Server API生成，兼容性更好
- 敏感词过滤精简，减少误报
- 验证码输入框支持6位TOTP码和9位备用码

---

## APP客户端更新日志

### 2026-01-02

#### 首页样式修复
- 修复 `pages/index/index.vue` 缺失的 `<style>` 部分
- 添加完整的首页样式：导航栏、Hero区域、公告栏、统计区域、产品卡片、域名后缀、我的资产、快捷服务、特性区域、页脚等

#### 虚拟主机文件管理修复
- 修复文件管理 API 路径传递问题
- 改进文件列表加载、文件打开、文件编辑等功能的错误处理

#### 虚拟主机用户端模块
- 新增虚拟主机 API 模块（套餐、购买、实例管理、订单、域名绑定、文件管理、PHP版本、运行目录、伪静态、SSL证书）
- 新增虚拟主机购买页面（套餐列表、套餐选择、域名输入、优惠码支持）
- 新增虚拟主机列表页面（主机列表、状态筛选、下拉刷新）
- 新增虚拟主机详情页面（基本信息、域名绑定、文件管理、设置）
- 在个人中心页面添加虚拟主机入口

#### 虚拟主机管理端
- 新增虚拟主机管理 API（服务器、套餐、实例、订单、统计）
- 新增虚拟主机管理页面（统计、服务器、套餐、主机、订单标签页）
- 在管理后台首页添加虚拟主机管理入口

#### OAuth 第三方登录绑定
- 新增 OAuth 相关 API（状态获取、授权URL、绑定/解绑）
- 在安全设置页面添加第三方账号绑定模块（GitHub、Google、NodeLoc）
- 在登录页面添加第三方登录入口

#### 阿里云邮件推送配置
- 在系统设置页面添加阿里云邮件推送配置区块

#### 首页UI优化
- 优化"为什么选择我们"卡片样式
- 添加渐变背景色和彩色圆形渐变图标背景

---

### 2025-12-31

#### APP 端图形验证码支持
- 在请求头添加 `X-Client-Type: app` 标识
- APP 端自动使用图形验证码，H5 端使用 Turnstile
- 登录、注册、忘记密码、修改密码、修改邮箱页面均已支持图形验证码

#### 用户管理增强
- 用户详情弹窗新增 OAuth 绑定信息显示
- 支持管理员解绑用户的 OAuth 账号

#### 数据管理页面
- 新增数据管理页面
- 支持导出用户/二级域名/卡密数据为 CSV 格式
- 支持从 CSV 批量导入用户/卡密
- 在管理后台首页添加数据管理入口

#### 用户安全设置页面
- 新增安全设置页面
- 支持双因素认证 (2FA) 设置、启用、禁用
- 支持备用码生成和管理
- 支持 API 密钥生成、查看、重置
- 支持 API 启用/禁用切换和 IP 白名单管理
- 支持登录 IP 限制设置和登录历史记录查看

#### 管理端邮件模板管理
- 新增邮件模板管理页面
- 支持查看/编辑邮件模板、模板变量提示、邮件预览、发送测试邮件、重置模板

#### 管理端 IP 黑名单管理
- 新增 IP 黑名单管理页面
- 支持查看/搜索黑名单、添加/解除 IP 封禁

#### 管理端系统设置完善
- 重构系统设置页面
- 新增注册设置、验证码设置、OAuth 登录配置、网站统计代码配置
- 优化页面 UI 布局，分组更清晰

---

## 版本说明

- **后端版本**：基于 Python Flask 框架，支持 Docker 部署
- **APP版本**：基于 uni-app 框架，支持 Android、iOS、H5、微信小程序等多平台

如需了解更多更新详情，请查看项目仓库的提交记录。
