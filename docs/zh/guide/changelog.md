# 六趣DNS更新日志

---

## 2025-12-30

### Cloudflare Turnstile 验证
- 新增 Cloudflare Turnstile 人机验证支持
- 管理员可在系统设置中配置 Turnstile Site Key 和 Secret Key
- 启用后自动替换图形验证码，提升用户体验
- 支持登录、注册、找回密码、修改密码、修改邮箱等场景
- 未配置时自动降级为图形验证码

### 验证码弹窗优化
- 用户个人中心修改密码/邮箱时，验证码改为弹窗显示
- 点击"发送验证邮件"按钮后弹出验证码窗口
- 支持 Turnstile 和图形验证码两种模式

### 系统内存优化
- SQLAlchemy 连接池优化：显式设置 pool_size=5、max_overflow=10
- APScheduler 线程池从默认10减少到2，添加任务合并
- MemoryCache 限制最大条目500，优化清理策略
- 验证码图片尺寸优化：160x50 → 120x40
- 验证码内存存储上限从1000减少到500
- Gunicorn worker 数量从4减少到2
- Docker 容器内存限制：App 512MB、Redis 64MB（LRU淘汰）

### 侧边栏UI优化
- 用户信息区域重新设计：头像、用户名、邮箱、退出按钮在同一行
- 退出登录改为图标按钮，更简洁
- 管理员切换按钮居中显示，样式更紧凑
- 移除导航区域底部重复的切换链接

### 其他优化
- 全局时区统一使用北京时间
- Redis 支持验证码存储，解决多进程问题
- 首页简化，移除服务商图标和使用流程

---

## 2025-12-29

### 邮件模板自定义
- 新增邮件模板管理功能，支持在后台自定义邮件内容
- 支持7种邮件模板：注册验证、重置密码、邮箱变更、域名到期提醒、域名删除通知、自动续费成功/失败
- 模板支持变量替换，如站点名称、域名、到期时间等
- 支持启用/禁用模板、重置为默认模板
- 支持发送测试邮件到管理员邮箱
- 定时任务已更新为使用数据库模板发送邮件

### 界面优化
- 首页移动端适配优化，修复内容超出屏幕问题
- 可用域名卡片移动端布局优化，支持长域名显示
- 管理后台首页添加版本号显示

### Bug修复
- 修复base.html系统设置菜单HTML结构错误导致无法展开

---

## 2025-12-28

### 六趣DNS分销模式
- 新增上游域名同步功能，支持从上游六趣DNS实例导入可用域名和套餐
- 管理员可在渠道管理中点击"同步域名"获取上游可购买的域名列表
- 支持选择性导入域名和套餐，自动设置默认售价（上游价格×1.2）
- 用户购买分销域名时自动调用上游API完成购买
- 用户续费分销域名时自动调用上游API完成续费
- 新增数据库字段：domains.upstream_domain_id、plans.upstream_plan_id、plans.upstream_price、subdomains.upstream_subdomain_id

### 开放API功能
- 新增用户开放API，支持外部系统对接
- 用户可在"账户设置 > API管理"生成/管理API密钥
- 支持API Key + Secret签名认证
- 支持IP白名单限制
- 提供完整的API接口：用户信息、域名列表、子域名管理、DNS记录管理
- 新增 `/api/open/domains/{id}/plans` 接口获取域名套餐
- 新增 `/api/open/purchase` 接口购买子域名

### 六趣DNS渠道对接
- 新增"六趣DNS"服务商类型，支持对接其他六趣DNS实例
- 可作为下游系统对接上游六趣DNS的开放API
- 支持完整的DNS记录管理（增删改查）
- 配置项：API地址、API Key、API Secret

### 移动端UI优化
- 修复登录/注册页面验证码输入框过长导致图片超出屏幕
- 修复用户首页卡片超出屏幕，改为2x2网格布局
- 修复用户个人中心修改邮箱/密码验证码输入框溢出
- 修复管理员DNS解析查询页面移动端布局问题
- 优惠券管理页面移动端改为卡片视图

### 功能优化
- 优惠券支持排除域名功能，可指定某些域名不能使用优惠券
- 修复编辑优惠券时添加排除域名报错"请填写必填项"的问题
- 操作日志的操作类型和目标类型显示为中文（如：创建、更新、删除、用户、域名等）

---


## 2025-12-27

### 多DNS服务商支持

#### 新增DNS服务商（共11种）
| 服务商 | 说明 |
|--------|------|
| Cloudflare | 全球CDN，支持代理模式 |
| 阿里云DNS | 国内主流，支持线路解析 |
| 腾讯云DNSPod | 国内主流，支持线路和权重 |
| 华为云DNS | 国内云服务商 |
| 西部数码 | 国内域名服务商 |
| AWS Route53 | 亚马逊云DNS服务，支持权重路由 |
| GoDaddy | 国际域名注册商 |
| Namecheap | 国际域名注册商 |
| Name.com | 国际域名服务商 |
| 百度智能云 | 国内云服务商 |
| NameSilo | 国际域名注册商 |

#### 功能特性
- 统一的DNS服务接口，支持多种服务商
- 各服务商能力自动检测（线路、代理、权重）
- 渠道管理模块，灵活配置DNS凭证
- 支持A、AAAA、CNAME、TXT、MX、NS等记录类型

#### 界面优化
- 首页全新设计，现代化渐变风格
- 服务商图标展示，支持11种DNS服务商
- 统计数据展示（用户数、域名数、解析记录数）
- 四列特性卡片，悬停动效
- 域名卡片重新设计，申请流程优化
- 使用流程步骤展示，带连接线动画
- 底部改为白色主题，与整体风格协调
- 登录/注册按钮优化，未登录显示双按钮

#### 文档更新
- 管理员文档新增渠道管理模块说明
- 用户文档新增DNS服务商功能支持表
- 索引文档更新为v3.0多服务商版本

#### Bug修复
- 修复DNSPod线路参数和TTL限制问题
- 修复阿里云SDK兼容性问题
- 修复前端删除/编辑记录的API调用
- 修复NS记录操作的特殊处理
- 修复Alpine.js模板条件判断语法错误

---

## 2025-12-23

### 上午更新
- 手动模式：到期邮箱提示、删除DNS记录、删除域名
- 卡密管理：批量删除、禁用卡密
- 后台首页：更多统计卡片、快捷入口

### 下午更新

#### 新功能
| 功能 | 说明 |
|------|------|
| 购买页面域名实时检查 | 输入域名前缀时实时检测可用性 |
| 管理员仪表盘图表 | ECharts可视化展示用户、域名、订单统计 |
| IP黑名单管理 | 管理员可添加/删除IP黑名单 |
| 2FA安全设置 | 用户可启用TOTP双因素认证、生成备用码 |
| 优惠券管理 | 管理员创建/编辑优惠券，支持折扣和固定金额 |
| 购买支持优惠码 | 用户购买时可输入优惠码享受折扣 |
| 侧边栏导航更新 | 新增安全设置、优惠券、IP黑名单入口 |
| 登录2FA验证 | 启用2FA的用户登录需输入6位验证码 |
| 删除域名2FA验证 | 启用2FA的用户删除域名需验证身份 |

#### 技术改进
- 2FA二维码使用QR Server API生成，兼容性更好
- 敏感词过滤精简，减少误报
- 验证码输入框支持6位TOTP码和9位备用码


> 完整更新日志请查看 [GitHub Releases](https://github.com/976853694/cloudflare-DNS/releases)
